<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--360浏览器优先以webkit内核解析-->
    <title></title>
    <link href="../../css/bootstrap.min.css?v=3.3.6" rel="stylesheet">
    <link href="../../css/font-awesome.css?v=4.4.0" rel="stylesheet">
    <link href="../../css/animate.css" rel="stylesheet">
    <link href="../../css/style.css?v=4.1.0" rel="stylesheet">
    <link href="../../plugin/datepicker/jquery.datetimepicker.css" rel="stylesheet">
    <link href="../../plugin/font/iconfont.css" rel="stylesheet">

    <style>
        #topKzCon{padding:10px 20px;;}
        #topKzCon .btn{color:#0055aa;}
        #topKzCon .btn:hover{    background-image: none;  outline: 0;  -webkit-box-shadow: inset 0 3px 5px rgba(0,0,0,.125); }
        .btnRight{float:right;}
        .conBox{width:100%;height:550px;border:1px solid #bbb;}
        #mainCont{width:60%;height:100%;float:left;border-right:1px solid #bbb;}
        #detailCon{width:40%;height:100%;float:left;}
        #mainCont .mainContitleBox{width:100%;height:74px;line-height: 45px;padding:0 6px;border-bottom:1px solid rgba(187,187,187,1);}
        #mainConTitle{width:84%;height:70px;margin:0 2px;margin-top:2px;padding-left:6px;line-height: 16px;vertical-align: middle;}
        #mainContain{width:100%;height:calc(100% - 75px);background:#fff;overflow-y: auto;padding:0;}
        #detailCon .detailContitleBox{width:100%;}
        #detailCon .detailContitleBox td{height:44px;border:1px solid #ccc;text-align: left;padding-left:10px;position: relative;}
        #detailCon .detailContitleBox td input,
        #detailCon .detailContitleBox td select{height:30px;width:76px;padding-left:3px;border:1px solid #bbb;
            -webkit-border-radius: 3px;
            -moz-border-radius: 3px;
            border-radius: 3px;}
        #detailCon .detailContitleBox td .left{float:left;margin:0 2px;position: relative;}
        #talkAboutBox .tittleBox{width:100%;height:40px;line-height: 40px;border:1px solid #bbb;}
        #talkAboutBox .tittleBox span{display:inline-block;height:100%;text-align: center;}
        #talkAboutBox  .commentSectionBox{width:100%;padding:12px;height:176px;overflow-y: auto;}
        #talkAboutBox  .commentSectionBox .commentSection{width:100%;overflow: hidden;height:auto;}
        #talkAboutBox .commentSection .userTitle .imgBox{width:25px;height:25px;border:1px solid #aaa;overflow: hidden;display: inline-block;
            -webkit-border-radius: 50%;
            -moz-border-radius: 50%;
            border-radius: 50%;vertical-align: middle;}
        #talkAboutBox{background:#f0f3f4;}
        #talkAboutBox .userTitle .imgBox img{width:100%;height:100%;}
        #talkAboutBox .commentSection{border-bottom:1px dashed #bbb;}
        #talkAboutBox .commentSection .userTitle{width:150px;float:left;}
        #talkAboutBox .commentSection .conmentsConts{width:calc(100% - 300px);padding:0 15px;float:left;}
        #talkAboutBox .commentSection .doBox{float:left;}
        #talkAboutBox .commentSection .doBox .reply{color:#0064b6;padding-right:12px;}
        #talkAboutBox .commentSection .praiseBox i{font-size:18px;margin-right:3px;}
        #talkAboutBox .commontsSrBox{width:100%;height:120px;padding:12px;border:1px solid #bbb;position: relative;}
        #myNameSelect{width:145px;height:30px;vertical-align: text-top;}
        #myComments{width:calc(100% - 400px);vertical-align: text-top;margin-right:9px;height:75px;}
        #mySetNum{width:75px;height:20px;padding-left:6px;}
        #myConmentsEnter{position: absolute;left:20px;top:30px;}
        #myConmentsSub{position: absolute;left:95px;top:30px;}
        .selefCon:hover{background:#179d82;color:#fff;}
        .recalltalkcon{padding-left:12px;position: relative}
        .recalltalkcon:hover{background:#179d82;color:#fff;}
        .recalltalkcon .callDoBox{position: absolute;right:-70px;bottom:3px;font-size:11px;}
        .recalltalkcon .callDoBox .reply{padding-right:6px;}
        .recalltalkcon:hover .callDoBox span{color:#bbb;!important;}
        #talkAboutBox .reply:hover,
        #talkAboutBox .praiseBox:hover{color:#f91515;cursor: pointer;}
        #talkAboutBox .commentSection .doBox .reply:hover{color:#f91515;}
        #commentlistBox{width:100%;height:140px;overflow-y: auto;}
        #detailCon .searchMenu .searchTag{width:76px;height:30px;}
        #detailCon .searchMenu .searchSecondMenu{position: absolute;width:100%;left:0;top:28px;background:#eee;color:#bbb;list-style: none;padding:0;z-index: 98;border:1px solid #bbb;border-top:none;display: none;max-height: 420px;overflow-y: auto;}
        #detailCon .searchMenu .searchSecondMenu.show{display: block;}
        #detailCon .searchSecondMenu li{width:100%;text-align: left;padding-left:3px;cursor: pointer;line-height: 23px;}
        #detailCon .searchSecondMenu li:hover{background:#fff;color:#333;border-top:1px solid #bbb;}
        #editoBtn{margin:10px; display: none;}
        #editoBtn.show{display: block;}
        #movieImgBox{display: none;position: relative}
        #movieImgBox.show{display: block;}
        #movieImgBox .movieinputBox{position: absolute;left:82px;bottom:1px;width:75px;height:32px;overflow: hidden;}
        #movieImgBox .moviebtn{display: inline-block;width:100%;height:27px;line-height: 27px;text-align: center;background:#568fb9;cursor: pointer;color: #fff;
            -webkit-border-radius: 3px;z-index:50;
            -moz-border-radius: 3px;
            border-radius: 3px;}
        #movieImgBox .movieshowimg{border: 1px solid #9d9e9e;overflow: hidden;width: 80px;height: 80px;line-height: 80px;text-align: center;  background: rgba(255,255,255,.4);  cursor: pointer;}
        #movieImgBox .movieshowimg img{width: auto;height: auto;max-width: 80px;max-height: 80px;}
        #movieimgfile{ position: absolute;top:0;left:0;z-index:60;cursor: pointer;width:100%;height:100%;opacity: 0;}
        #movieImgBox .movieinputBox:hover .moviebtn{background:#204663;}
        #movieImgBox .tips{color:#ce0000;font-size:8px;position: absolute;bottom:25px;left:82px;display: none;}
        #movieImgBox .tips.show{display: block;}
    </style>
</head>

<body class="gray-bg">
<div id="topKzCon">

    <a class="backBtn btn "  href="javascript:void(0);" onclick="backuncheck()">返回</a>
    <a href="#" class="preBtn btn" >上一页</a>
    <a href="#" class="nextBtn btn" >下一页</a>
    <span class="submit btn" onclick="subd()">提交</span>
    <a href="#" class="requck btn btnRight">重置</a>
</div>
<div class="conBox">
    <div id="mainCont">
        <div class="mainContitleBox">
            文字描述 <textarea id="mainConTitle" maxlength="300" placeholder="我是标题"></textarea>
            <i class="contitleTip">4个字</i>
        </div>
        <!--视频和图片页面的容器-->
        <div id="mainContain">

        </div>
    </div>
    <div id="detailCon">
        <table class="detailContitleBox">
            <tbody>
            <tr>
                <td id="movietypetd">
                    横竖视频：
                    <span id="movieStyle" data-val="1"></span>

                </td>
                <td>
                    内容等级：
                    <select name="" id="checkConLevel">
                        <option value="">请选择</option>
                        <option value="3">A</option>
                        <option value="2">B</option>
                        <option value="1">C</option>
                        <option value="D">D</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td id="conlabeltd" colspan="2">
                    <div class="left title">
                        标签分类：
                    </div>
                    <div class="left searchMenu">
                        <input type="search" value="" data-val="" placeholder="请选择标签" id="checkTagSearch1" class="searchTag"/>
                        <ul class="searchSecondMenu" id="checkTagul1">

                        </ul>
                    </div>
                    <div class="left searchMenu">
                        <input type="search" value="" data-val="" placeholder="请选择标签" id="checkTagSearch2" class="searchTag"/>
                        <ul class="searchSecondMenu" id="checkTagul2">

                        </ul>
                    </div>
                    <div class="left searchMenu">
                        <input type="search" value="" data-val="" placeholder="请选择标签" id="checkTagSearch3" class="searchTag"/>
                        <ul class="searchSecondMenu" id="checkTagul3">

                        </ul>
                    </div>

                    <!--   <select name="" id="checkTag">
                          &lt;!&ndash; <option value="1">标签1</option>
                           <option value="2">标签2</option>
                           <option value="3">标签3</option>&ndash;&gt;
                       </select>
                       <select name="" id="checkTag2">
                         &lt;!&ndash;  <option value="1">标签1</option>
                           <option value="2">标签2</option>
                           <option value="3">标签3</option>&ndash;&gt;
                       </select>
                       <select name="" id="checkTag3">
                           &lt;!&ndash;<option value="1">标签1</option>
                           <option value="2">标签2</option>
                           <option value="3">标签3</option>&ndash;&gt;
                       </select>-->
                </td>

            </tr>

            <tr>
                <td>
                    顶： <input type="number" id="goodNum" value="1" min="0"/>
                </td>
                <td class="">
                    踩：<input type="number" id="unsupportNum" value="1" min="0"/>
                </td>
            </tr>
            <tr>
                <td class="checkGetfromBox">
                    抓取来源：<span id="checkGetfrom">新浪微博</span> <!--<a href="#">源地址：www.5555.com</a>-->
                </td>
                <td class="moviePlayNumBox">
                    视频播放次数：<input type="number" id="moviePlayNum" value="1" min="0"/>
                </td>
            </tr>
            <tr>
                <td colspan="2">
                    发布人：
                    <select name="" id="checkpublisher" style="width:120px;">
                        <!--<option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>-->
                    </select>
                </td>
            </tr>

            <!-- <tr>
                 <td colspan="2" style="height:133px;">
                     专栏选择：<select name="" id="checkColumChoose" style="width:200px;">
                     <option value="1">我是专栏一</option>
                 </select>
                 </td>
             </tr>-->
            <tr>
                <td colspan="2">
                    预发布时间：
                    <input type="text" value="" id="prereleaseTime" style="width:200px;"/>
                </td>
            </tr>
            <tr>
                <td colspan="2">
                    最后审核人：
                    <span id="finalAuditor"></span>
                </td>
            </tr>
            </tbody>
        </table>
        <div id="commentlistBox">
            <ul>
                <li></li>
            </ul>
        </div>
        <div>
            <button id="editoBtn" class="">图片编辑</button>
            <div id="movieImgBox" class="">
                <div class="movieshowimg">
                    <img src="" alt=""/>
                </div>
                <p class="tips">*视频与缩略图的宽高比有误，请检查！！</p>
                <div class="movieinputBox">

                    <div style="width:100%;position: relative;height:27px;">
                        <input type="file" id="movieimgfile" value="" accept=".png,.jpg,.gif,.jpeg"/>
                        <span class="moviebtn">替换封面</span>
                    </div>

                </div>

            </div>
        </div>

    </div>

</div>

<!--底部评论管理-->
<div id="talkAboutBox">
    <div class="tittleBox">
        <span style="width:43%;">评论管理</span>
        <span style="width:25%;border-right:1px solid #bbb;border-left:1px solid #bbb;">评论数 ：<b class="talkNum"></b></span>
        <span style="width:25%;">热评数 :<b class="hotTalkNum"></b></span>
    </div>
    <div class="commentSectionBox" id="commentSectionBox">
        <div class="commentSection" v-for="(item,i) in items" v-bind:data-commentid="item.commentid" v-bind:data-commentreply="item.commentreply" v-bind:data-replycomment="item.replycomment" v-bind:data-replyuser="item.replyuser" v-bind:data-replyfirst="item.replyfirst">
            <p class="userTitle">
                <span class="imgBox"><img v-bind:src="item.userimg" alt=""/></span>
                <span class="userName" v-bind:data-id="item.userid">{{item.userName}}：</span>
            </p>
            <div class="conmentsConts" v-bind:data-replyuser="item.replyuser">
                <p class="selefCon" v-bind:data-contentid="item.contentid">{{item.commenttext}}</p>

                <div class="recalltalkcon" v-for="(itemcon,d) in item.recall"  v-bind:data-contentid="item.contentid"  v-bind:data-commentid="itemcon.commentid" v-bind:data-commentreply="itemcon.commentreply" v-bind:data-replycomment="itemcon.replycomment" v-bind:data-replyuser="itemcon.replyuser" v-bind:data-replyfirst="itemcon.replyfirst">
                    <span class="recalluser" :data-id="itemcon.userid"  v-bind:data-replyuser="item.replyuser">{{itemcon.userName}}  回复  {{itemcon.replyusername}}：</span>
                    {{itemcon.commenttext}}
                    <div class="callDoBox">
                        <span class="reply" v-on:click="backcalltalk(itemcon,i,d)">回复</span>
                        <span class="praiseBox"  v-on:click="callgoods(itemcon,i,d)"><i class="glyphicon glyphicon-thumbs-up"></i><b class="praiseNum">{{itemcon.commentgood}}</b></span>
                    </div>
                </div>

            </div>
            <div class="doBox">
                <span class="reply" v-on:click="backtalk(item,i)">回复</span>
                <span class="praiseBox" v-on:click="goods(item,i)"><i class="glyphicon glyphicon-thumbs-up"></i><b class="praiseNum">{{item.commentgood}}</b></span>
            </div>
        </div>

    </div>



    <div class="commontsSrBox" id="commontsSrBox" data-type="0" data-list="" data-list2="" style="background:#f0f3f4;border-top:1px solid #bbb;padding:3px;padding-bottom:20px;">
        <select name="" id="myNameSelect">
            <!-- <option value="12313"><span class="myname">我是马甲用户</span></option>
             <option value="123134"><span class="myname">我是马甲用户2</span></option>
             <option value="123135"><span class="myname">我是马甲用户3</span></option>-->
        </select>
            <textarea rows="1" cols="20" id="myComments" maxlength="200">

            </textarea>
            <span class="" style="position: relative;">
                点赞数 <input type="number" id="mySetNum" value="0"/>
                <button type="button" class="btn btn-sm btn-primary" id="myConmentsEnter" onclick="enterd()">发 送</button>
                <!--<button type="button" class="btn btn-sm btn-primary" id="myConmentsSub" onclick="subd()">提交</button>-->
            </span>

    </div>
</div>


<script src="../../js/jquery.min.js?v=2.1.4"></script>
<script src="../../plugin/datepicker/jquery.datetimepicker.full.min.js"></script>
<script src="../../plugin/layer/layer.js"></script>
<script src="../../js/vue.js"></script>
<script type="text/javascript" src="../../js/index.js"></script>
<script src="../../plugin/cos-js-sdl-v5/cos-js-sdk-v5.min.js"></script>
<script src="../../plugin/cos-js-sdl-v5/cos.js"></script>
<script type="text/javascript">


    $(function(){

        getchecktype();
        let dataval="",searchid=0;
        getlabellist(dataval,searchid);
        getpush();
        var date=new Date();
        $('#prereleaseTime').datetimepicker({
            value:date,
            format:'Y-m-d',
            timepicker:false//关闭时间选项
        });

    })
    var fileslist=[];//图片流
    var iffilechange=1;//图片是否有替换或旋转:2视频替换，3图片旋转
    var fielchangelist=[];//图片旋转改变的得到的云链接
    /*品论区*/
    var usertalk = new Vue({
        el: '#commentSectionBox',
        data: {
            items: []
        },
        // 在 `methods` 对象中定义方法
        methods: {
            goods: function (event,i) {
                this.items[i].commentgood++;
            },
            callgoods:function (event,i,d) {
                this.items[i].recall[d].commentgood++;
            },
            backtalk:function(event,i){
                var callid=this.items[i].userid;
                var callname=this.items[i].userName;
                $("#commontsSrBox").attr("data-type",1);
                $("#commontsSrBox").attr("data-list",i);
                $("#commontsSrBox").attr("data-list2","");
                $("#myComments").attr("placeholder","回复"+callname+"：")
            },
            backcalltalk:function(event,i,d){
                var callid=this.items[i].recall[d].userid;
                var callname=this.items[i].recall[d].userName;
                $("#commontsSrBox").attr("data-type",2);
                $("#commontsSrBox").attr("data-list",i);
                $("#commontsSrBox").attr("data-list2",d);
                $("#myComments").attr("placeholder","回复"+callname+"：")
            }
        }
    });

    /*获取审核类型加载视频/图片页面*/
    function getchecktype(){
        //根据iframe的id获取对象
        layer.msg('努力中...', {icon: 16,shade: [0.5, '#f5f5f5'],scrollbar: true,offset: '50px', time:1000}) ;
        let ifinfo = window.location.search;
        ifinfo=ifinfo.substring(4);
        ifinfo=ifinfo.split(",");
        var rehref = window.location.href;
        $("#topKzCon .requck ").attr("href",rehref);//重置
        var localindodata22=JSON.parse(localStorage.uncheckdata);
        var index=ifinfo[0];
        let urllist=JSON.parse(localindodata22.ContentList[index].daqurllist);
        var path3="/CTKJBUSINESS/file/downFileByName.do?filelocation=";
        $.each(urllist,function(i,n){
            fileslist.push(n);//图片/视频地址集合
            fielchangelist.push({"ischange":false,"imgurl":n})
        })

        if(ifinfo[0] =="0"){
            $("#topKzCon .preBtn").attr("href","javascript:void(0);");//上一页
        }else{
            var prenum=Number(ifinfo[0])-1;
            var pageno=ifinfo[2];
            var contype=localindodata22.ContentList[prenum].daqtype;
            $("#topKzCon .preBtn").attr("href","checksconts.html?in="+prenum+","+contype+","+pageno);//上一页
        }
        var length=localindodata22.ContentList.length-1;
        if(Number(ifinfo[0]) ==length){
            $("#topKzCon .nextBtn ").attr("href","javascript:void(0);");//下一页
        }else{
            var nextnum=Number(ifinfo[0])+1;
            var pageno=ifinfo[2];
            var contype2=localindodata22.ContentList[nextnum].daqtype;
            $("#topKzCon .nextBtn ").attr("href","checksconts.html?in="+nextnum+","+contype2+","+pageno);//下一页
        }
        //ifinfo=JSON.parse(ifinfo);
        ////console.log(ifinfo);
        var murl="moveicheck.html";

        if(ifinfo[1] == "3"){
            murl="picturecheck.html?in="+ifinfo[0];

            $("#movieStyle").attr("data-val",3).html("图片");
            $(".checkGetfromBox").attr("colspan","2");
            $(".moviePlayNumBox").css({"display":"none"});
        }else{
            murl="moveicheck.html?in="+ifinfo[0];

            $(".checkGetfromBox").attr("colspan","1");
            $(".moviePlayNumBox").css({"display":"table-cell"});
            $("#movieImgBox").addClass("show");

        }
        ////console.log(ifinfo[1]);
        // //console.log(murl);
        $("#mainContain").load(murl,function(){

        });

        if(localStorage.uncheckdata){

            var rightindodata=localindodata22.ContentList[index];
            ////console.log("rightindodata:");
            // //console.log(rightindodata);
            rightinfo(rightindodata);
        }
    }

    /*视频/图片右侧信息*/
    function rightinfo(datainfolist){
        var contitle=filteremoji(datainfolist.daqtitle);
        $("#mainConTitle").val(contitle);
        $("#mainCont .contitleTip").html(datainfolist.daqtitle.length+"/字");
        $("#checkGetfrom").html(datainfolist.daqsource);
        $("#finalAuditor").html(userdatas.data.username);
        $("#commentlistBox ul").empty();
        $.each(datainfolist.commentlist,function(i,n){
            $("#commentlistBox ul").append("<li>"+n.commenttext+"</li>")
        })
    }

    /*标签列表获取*/
    function getlabellist(dataval,searchid){
        var datapost={"taglevel":3,"pageno":1,"pagesize":999,"tagname":dataval};
        datapost=JSON.stringify(datapost);
        $.ajax({
            url : path2+'/CTKJBUSINESS/tag/taglist.do',
            cache:true,//false就不会从浏览器缓存中加载请求信息了
            type:"POST",
            contentType: "application/json",
            dataType:"JSON",
            async:false,
            data: datapost,
            //data: {taglevel:3,pageno:1,pagesize:999},
            error: function(data){
                layer.msg("服务器未响应,请稍后再试!");
                //console.log("标签列表获取失败：");
                //console.log(data);
            },
            success:function(diskJson){
//                console.log("标签列表获取：");
//                console.log(diskJson);

                if(searchid ==0){
                    $(".searchSecondMenu").empty();
                    $.each(diskJson.data.rows,function(i,n){
                        if(n.tagid&&n.tagid !=null && n.tagname && n.tagname!=null){
                            $(".searchSecondMenu").append(' <li data-val="'+ n.tagid+'">'+ n.tagname+'</li>');
                        }
                    });
                }else{
                    var searid="#"+searchid;
                    $(searid).siblings(".searchSecondMenu").empty();
                    $.each(diskJson.data.rows,function(i,n){
                        if(n.tagid&&n.tagid !=null && n.tagname && n.tagname!=null){
                            $(searid).siblings(".searchSecondMenu").append(' <li data-val="'+ n.tagid+'">'+ n.tagname+'</li>');
                        }
                    });

                }
            }
        });
    }
    /*标签搜索框焦点事件*/
    $("#detailCon .searchMenu .searchTag").focus(function(){
        $(this).siblings(".searchSecondMenu").addClass("show");
    });
    $("#detailCon .searchMenu .searchTag").blur(function(){
        var searchid=$(this).attr("id");
        setTimeout(function(){
            $("#"+searchid).siblings(".searchSecondMenu").removeClass("show");
        },500);

    });
    /*标签选择*/
    $("#detailCon .searchMenu .searchSecondMenu").delegate("li","click",function(){
        let txt=$(this).html();
        let dataval=$(this).attr("data-val");
        $(this).parent(".searchSecondMenu").siblings(".searchTag").val(txt).attr("data-val",dataval);
    });
    /*搜索框键盘输入*/
    $("#detailCon .searchMenu .searchTag").keyup(function(){
        $(this).attr("data-val","");
        var dataval=$(this).val();
        var searchid=$(this).attr("id");
        getlabellist(dataval,searchid)

    });
    $("#detailCon .searchMenu .searchTag").keydown(function(event) {
        if (event.keyCode == 13) {
            $(this).attr("data-val","");
            var dataval=$(this).val();
            var searchid=$(this).attr("id");
            getlabellist(dataval,searchid);
        }
    });
    /*马甲用户列表获取*/
    function getpush(){
        var createuser=userdatas.data.userid;
        var tjdatas={"pageno":1,"pagesize":999,"createuser":createuser};
        tjdatas=JSON.stringify(tjdatas);
        $.ajax({
            url : path2+'/CTKJBUSINESS/vest/vestlist.do',
            cache:true,//false就不会从浏览器缓存中加载请求信息了
            type:"POST",
            contentType: "application/json",
            dataType:"JSON",
            async:false,
            data: tjdatas,
            //data: {taglevel:3,pageno:1,pagesize:999},
            error: function(data){
                layer.msg("服务器未响应,请稍后再试!");
                //console.log("马甲用户列表失败：");
                //console.log(data);
            },
            success:function(diskJson){
//               console.log("马甲用户列表获取：");
//               console.log(diskJson);
                $("#checkpublisher").empty();
                $("#myNameSelect").empty();
                $.each(diskJson.data.rows,function(i,n){
                    $("#checkpublisher").append(' <option data-head="'+n.userheadphoto+'" value="'+ n.userid+'">'+ n.username+'</option>');
                    $("#myNameSelect").append(' <option  data-head="'+n.userheadphoto+'" value="'+ n.userid+'">'+ n.username+'</option>');
                })


            }
        });
    }

    /*发送*/
    var talknum=0;
    function enterd(){
        var text= $("#myComments").val();
        text= $.trim(text);
        if(text == ""){
            layer.msg("发送内容不能为空！");
        }else{
            var userid=$("#myNameSelect").val();
            var userName=$("#myNameSelect option:checked").text();
            var userHead=$("#myNameSelect option:checked").attr("data-head");
            var lvty= $("#commontsSrBox").attr("data-type");
            var index= $("#commontsSrBox").attr("data-list");
            var index2= $("#commontsSrBox").attr("data-list2");
            var goods=Number($("#mySetNum").val());
            var commentid=genID(22);//评论ID
            var contentid=genID(22);//内容ID
            var createtime=getmytime();

            if(lvty ==0){
                usertalk.items.push( { "commentid":commentid,"userid":userid,"replyuser":"","replyusername":"","commentreply":1,"userimg":userHead,"userName":userName,"contentid":contentid,"commenttext":text, "commentgood":goods,"replycomment":"","replyfirst":commentid,"createtime":createtime,recall:[]});
            }else if(lvty ==1){
                var replyuser=usertalk.items[index].userid;
                var replyusername=usertalk.items[index].userName;
                var replycomment =usertalk.items[index].commentid;
                usertalk.items[index].recall.push({ "commentid":commentid,"userid":userid,"replyuser":replyuser,"replyusername":replyusername,"commentreply":0,"userimg":userHead,"userName":userName,"contentid":contentid,"commenttext":text, "commentgood":goods,"replycomment":replycomment,"replyfirst":replycomment,"createtime":createtime});
            }else if(lvty ==2){
                var replyuser=usertalk.items[index].recall[index2].userid;
                var replyusername=usertalk.items[index].recall[index2].userName;
                var replycomment =usertalk.items[index].recall[index2].commentid;
                var replyfirst =usertalk.items[index].commentid;
                usertalk.items[index].recall.push({ "commentid":commentid,"userid":userid,"replyuser":replyuser,"replyusername":replyusername,"commentreply":0,"userimg":userHead,"userName":userName,"contentid":contentid,"commenttext":text, "commentgood":goods,"replycomment":replycomment,"replyfirst":replyfirst,"createtime":createtime});
            }
            $("#commontsSrBox").attr("data-type",0);
            $("#myComments").val("");
            $("#mySetNum").val(1);
            talknum++;
            $("#talkAboutBox .talkNum").html(talknum);
            $("#myComments").attr("placeholder","");

        }

    }


    /*提交图片/视频流*/
    function subd(){
        layer.msg('提交中...', {icon: 16,shade: [0.5, '#f5f5f5'],scrollbar: true,offset: '50px', time:20000}) ;
        if(localStorage.uncheckdata){
            var ifinfo = window.location.search;
            ifinfo=ifinfo.substring(4);
            ifinfo=ifinfo.split(",");
            var localindodata=JSON.parse(localStorage.uncheckdata);
            var index=ifinfo[0];

            //判断是否为D删除的
            var contleve=$("#checkConLevel").val();
            var tja=localindodata.ContentList[index];//本地缓存数据
            if(contleve == ""){
                layer.msg("请选择内容等级!!");
                return false;
            }else if(contleve == "D"){
                subd2(tja,"");
                return false;
            }else{
                //判断标题字数
                var content=$("#mainConTitle").val();
                var substr="MGC";
                if(content.length >300){
                    layer.closeAll();
                    layer.msg("标题超过限定字数！！");
                    //console.log(contenttitle.length);
                    $("#myConmentsSub").attr("disabled",false);
                    return false;
                }else if(content.indexOf(substr)>=0){
                   layer.msg("标题含有敏感词，请检查！！");
                   return false;
                }
                /*判断标签选择*/
                var ta1=$("#checkTagSearch1").attr("data-val");
                var ta2=$("#checkTagSearch2").attr("data-val");
                var ta3=$("#checkTagSearch3").attr("data-val");
                if(ta1 =="" && ta2=="" && ta3 ==""){
                    layer.closeAll();
                    layer.msg("请至少选择一项标签！！");
                    $("#myConmentsSub").attr("disabled",false);

                    return false;
                }
                ////console.log(locationListString);
                /*审核视频的 //若果缩略图被替换*/
                if(iffilechange==2){
                    var movielist=fileslist[0];
                    putObject(movielist,movietoyun);
                }else{
                    movietoyun();
                }
            }
        }
    }

    /*提交视频/图片-1*/
    function movietoyun(){
        var searchyunlist=[];
        //若果缩略图被替换
        if(iffilechange==2){
            if(fileslist.length>1){
                fileslist.splice(0,1);
            }
            searchyunlist=fileslist;
        }else if(iffilechange==3){
            $.each(fielchangelist,function(i,n){
                if(n.ischange == false){
                    searchyunlist.push(n.imgurl);
                }
            })
        }else{
            searchyunlist=fileslist;
        }
        var stringfiles=JSON.stringify(searchyunlist);
        var locationListString=encodeURI(stringfiles);
        $.ajax({
            url : path2+'/CTKJBUSINESS/file/uploadFiles.do',
            cache:true,//false就不会从浏览器缓存中加载请求信息了
            type:"POST",
            contentType: "application/json",
            dataType:"JSON",
            async:true,
            data: "{\"locationListString\":\""+locationListString+"\"}",
            //data: {taglevel:3,pageno:1,pagesize:999},
            error: function(data){
                layer.closeAll();
                $("#myConmentsSub").attr("disabled",false);
                layer.msg("资源上传云失败，请重试！！",{
                    offset:['50%'],
                    time: 1500 //2秒关闭（如果不配置，默认是3秒）
                });
            },
            success:function(diskJson){
//                console.log("提交图片/视频流获取：");
//                console.log(diskJson);
                if(diskJson.code =="1000"){
                    var geturl=diskJson.data;
                    if(iffilechange==2){
                        geturl.unshift(costdk);
                    }else if(iffilechange==3){
                        $.each(fielchangelist,function(i,n){
                            if(n.ischange == true){
                                geturl.push(n.imgurl);
                            }
                        })
                    }
                    subd2(geturl);
                }else{
                    layer.closeAll();
                    $("#myConmentsSub").attr("disabled",false);
                    layer.msg("资源上传云失败，请重试！！",{
                        offset:['50%'],
                        time: 1500 //2秒关闭（如果不配置，默认是3秒）
                    });
                }
            }
        });
    }

    /*最中提交*/
    function subd2(contenturllist){
//        console.log("contenturllist::");
//        console.log(contenturllist);
        var ifinfo = window.location.search;
        ifinfo=ifinfo.substring(4);
        ifinfo=ifinfo.split(",");
        var localindodata=JSON.parse(localStorage.uncheckdata);
        var index=ifinfo[0];
        var tjlocdata=localindodata.ContentList[index];

        var contenttitle=$("#mainConTitle").val();
        var contentid=tjlocdata.daqid;
        var contenttype="";
        var contentleve=$("#checkConLevel").val();
        var tag1=$("#checkTagSearch1").attr("data-val");
        var tag2=$("#checkTagSearch2").attr("data-val");
        var tag3=$("#checkTagSearch3").attr("data-val");
        var contenttag=[];
        var contentgoods=Number($("#goodNum").val());
        var contentuid=$("#checkpublisher").val();
        var contentsource=tjlocdata.daqsource;
        var createtime=$("#prereleaseTime").val();
        createtime=createtime.replace(/-/g, "");//
        var lastchenker=userdatas.data.userid;
        var commenttext=usertalk.items;
        var contenttext="";
        var contentbad=$("#unsupportNum").val();
        var playcount=$("#moviePlayNum").val();

        //判断是否为D删除的
        if(contentleve != "D"){
            if(tag1 =="" && tag2=="" && tag3 ==""){
                layer.closeAll();
                layer.msg("请至少选择一项标签！！");
                $("#myConmentsSub").attr("disabled",false);

                return false;
            }else{
                if(tag1 !="" && tag1 !=null){contenttag.push(tag1)}
                if(tag2 !="" && tag2 !=null){contenttag.push(tag2)}
                if(tag3 !="" && tag3 !=null){contenttag.push(tag3)}
                contenttag=unique10(contenttag)
            }
        }
//    判断contenttype类型
        if(tjlocdata.daqtype != "3"){
            contenttype=$("#movieStyle").attr("data-val");
            let w=$("#movieImgBox .movieshowimg img").attr("data-width");
            let h=$("#movieImgBox .movieshowimg img").attr("data-height");
            contenttext=w+","+h;

        }else{
            contenttype=3;
            let w=$("#imgconbox a:first-child").attr("data-width");
            let h=$("#imgconbox a:first-child").attr("data-height");
            contenttext=w+","+h;
        }

        var tjdatas={
            "contenttitle":contenttitle,
            "contentid":contentid,
            "contenttype":contenttype,
            "contenturllist":contenturllist,
            "contentlevel":contentleve,
            "contenttag":contenttag,
            "contentgoods":contentgoods,
            "contentuid":contentuid,
            "contentsource":contentsource,
            "createtime":createtime,
            "checkuid":lastchenker,
            "contentbad":contentbad,
            "playcount":playcount,
            "contenttext":contenttext,
            "commenttext": commenttext};

//            console.log("tijiao 2postdata:");
//         console.log(tjdatas);
        tjdatas=JSON.stringify(tjdatas);
        $.ajax({
            url : path+'/CTKJBUSINESS/content/pushcontent.do',
            cache:true,//false就不会从浏览器缓存中加载请求信息了
            type:"POST",
            contentType: "application/json",
            dataType:"JSON",
            async:true,
            data: tjdatas,
            error: function(data){
                layer.closeAll();
                $("#myConmentsSub").attr("disabled",false);
                layer.msg("审核提交失败，请重试！！",{
                    offset:['50%'],
                    time: 1500 //2秒关闭（如果不配置，默认是3秒）
                })
                //console.log("提交图片/视频流失败：");
                //console.log(data);
            },
            success:function(diskJson){
                layer.closeAll();
                /*                console.log("提交审核：");
                 console.log(diskJson);*/
                if(diskJson.code =="1000"){
                    layer.msg('提交成功...', {icon: 16,shade: [0.5, '#f5f5f5'],scrollbar: true,offset: '50px', time:250}) ;
                    backuncheck();
                }else{
                    $("#myConmentsSub").attr("disabled",false);
                    layer.msg("审核提交失败，请重试！！",{
                        offset:['50%'],
                        time: 1500 //2秒关闭（如果不配置，默认是3秒）
                    });
                }

            }
        });

    }



    /*判断字数*/
    $("#mainConTitle").keyup(function(){
        var len=$(this).val().length;
        $("#mainCont .contitleTip").html(len+"个字");
    });

    function backuncheck(){
        let ifinfo = window.location.search;
        ifinfo=ifinfo.substring(4);
        ifinfo=ifinfo.split(",");
        setTimeout(function(){
//        console.log(ifinfo);
//        console.log(ifinfo[2]);
            window.location.href="content-check.html?pageon="+ifinfo[2];
        },250)
    }



    $("#editoBtn").click(function(){
        $("#imgEditBox").addClass("show");
    });


    /*缩略图编辑打开*/
    $("#movieImgBox .movieshowimg").click(function(){
        let imgsrc=$("#movieImgBox .movieshowimg img").attr("src");
        $("#imgEditBox .imgshowBox img").attr("src",imgsrc);
        $("#imgEditBox").addClass("show");
    });
    /*视频封面替换*/
    $("#movieimgfile").change(function(){
        var files = this.files[0];
        var fileSize = 0;
        var fileMaxSize = 1024*3;//1M
        var filePath = $("#movieimgfile").val();
        if(filePath){
            fileSize =files.size;
            var size = fileSize / 1024;
            if (size > fileMaxSize) {
                layer.msg("图片太大啦！");
                file.value = "";
                return false;
            }else if (size <= 0) {
                alert("图片呢？？");
                file.value = "";
                return false;
            }
        }
        if (window.FileReader) {
            var reader = new FileReader();
            reader.readAsDataURL(files);
            //监听文件读取结束后事件
            reader.onloadend = function (e) {
                fileslist[0]=files;
                iffilechange=2;
                let img = new Image();              //手动创建一个Image对象
                img.src = e.target.result;//创建Image的对象的url
                img.onload = function () {
                    //console.log('height:'+this.height+'----width:'+this.width);
                    $("#movieImgBox .movieshowimg img").attr("data-width",this.width);
                    $("#movieImgBox .movieshowimg img").attr("data-height",this.height);
                };
                $("#movieImgBox .movieshowimg img").attr("src",e.target.result);    //e.target.result就是最后的路径地址


            };
        }
    })

    /*改变内容等级赋予默认点赞数*/
    $("#checkConLevel").change(function(){
        var level=$(this).val();
        var minnum="",maxnum="",minnum2="",maxnum2="";
        switch(level){
            case "3":minnum=200;maxnum=400;minnum2=400;maxnum2=800;break;
            case "2":minnum=100;maxnum=200;minnum2=200;maxnum2=500;break;
            case "1":minnum=20;maxnum=100;minnum2=40;maxnum2=300;break;
        }
        var num=randomnum(minnum,maxnum);
        var num2=randomnum(minnum2,maxnum2);
        $("#goodNum").val(num);
        $("#moviePlayNum").val(num2);
    })
</script>
</body>
</html>