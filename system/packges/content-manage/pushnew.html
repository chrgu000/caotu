
<style>
    /* Additional style to fix warning dialog position */
    .labelBox{width:80%;min-width:370px;margin:0 auto;padding:40px 20px;border:1px solid #bbb;margin-top:15px;min-height: 450px;}
    .lineBox{width:100%;margin:20px 0;position: relative;}
    .lineBox .lineTitle{display:inline-block;width:120px;margin-right:6px;text-align: right;}
    .lineBox input,
    .lineBox select,#contentText{width:300px;height:30px;padding-left:7px;}
    #contentText{height:90px;vertical-align:top;}
    #backbtn{float:right;margin-top:-9px;}
    #allUser{height:20px;width:25px;cursor: pointer;}
    .must{color:#f11c1c;}
</style>

<div style="width:80%;margin:0 auto;margin-top:25px;">
    <h4>新增推送消息 <button type="button" class="btn btn-sm btn-primary" id="backbtn">返回》</button></h4>
</div>
<div class="labelBox">
    <div class="lineBox">
        <span class="lineTitle">标题：</span>
        <input type="text" class="repead" id="newsTitle" value="" placeholder="请输入名称"/>
        <i class="must">*在300字以内</i>
    </div>
    <div class="lineBox">
        <span class="lineTitle">内容：</span>
        <textarea rows="1" cols="20" id="contentText" maxlength="200"></textarea>
        <i class="must" style="position: absolute;bottom:0;left:440px;">*在300字以内</i>
    </div>
    <div class="lineBox">
        <span class="lineTitle">内容类型：</span>
        <select name="" id="contentType">
            <option value="专栏">专栏</option>
            <option value="banner">banner</option>
            <option value="内容">内容</option>
            <option value="打开APP">打开APP</option>
        </select>
    </div>
    <div class="lineBox">
        <span class="lineTitle">详情：</span>
        <select name="" id="contenturl">
            <option value="专栏">专栏</option>

        </select>
    </div>
    <div class="lineBox">
        <span class="lineTitle">创建人：</span>
        <input type="text" id="creatuser" value="" readonly/>
    </div>
    <div class="lineBox">
        <span class="lineTitle">全体：</span>
        <input type="checkbox" checked="checked" data-id="" id="allUser" value=""/>
    </div>
    <div class="lineBox">
        <span class="lineTitle">单个：</span>
        <input type="text" id="oneUser" data-id="" value="" placeholder="输入用户昵称"/>
    </div>
    <div class="lineBox">
        <span class="lineTitle">推送时间：</span>
        <input type="text" id="pushTime" value="" />
    </div>
    <div class="lineBox" style="padding-left:130px;margin-top:35px;">
        <button type="button" class="btn btn-sm btn-primary" id="submit" onclick="creatlabel()">提 交</button>
        <button type="button" class="btn btn-sm btn-primary" id="replay" onclick="replay()">重 置</button>
    </div>
</div>


<script>
    $(function(){
        $("#creatuser").val(userdatas.data.username);
        var date = new Date();
        $('#pushTime').datetimepicker({
            minView : 2,
            value:date,
            format:'Y-m-d h:i',
            timepicker:true//关闭时间选项(true打开false关闭)
        });
    });
    /*返回*/
    $("#backbtn").click(function(){
        $("#contentPageBox").load("pushmana.html");
    });
    //账号限制
    $("#newsTitle").blur(function(){
        var dva=$(this).val();
        if(dva==""){
            layer.msg("标题不能为空！！")
        }/*else if(dva<4000 || dva>9999){
            layer.msg("请填写4000-9999范围内！！")
        }*/
    });
    $("#contentText").blur(function(){
        var dva=$(this).val();
        if(dva==""){
            layer.msg("消息内容不能为空！！")
        }
    });
    $("#allUser").click(function(){
        if($("input[type='checkbox']").is(':checked')){
            $("#oneUser").val("").attr("data-id","");
        }
    });
    $("#oneUser").focus(function(){
        $("#allUser").attr("checked",false);
    });

    /*创建运营账号*/
    function creatlabel(){
        var newsTitle=$("#newsTitle").val();
        var contentText=$("#contentText").val();
        var password=$("#password").val();
        var passwordsure=$("#passwordsure").val();
        if(newsTitle==""){
            layer.msg("标题不能为空！！");
            return false;
        }/*else if(newsTitle<4000 || newsTitle>9999){
            layer.msg("请填写4000-9999范围内！！")
            return false;
        }*/
        if(contentText==""){
            layer.msg("消息内容不能为空！！");
            return false;
        }

        var createuser=userdatas.data.userid;
        var datapost={"contentText":contentText,"createuser":createuser,"newsTitle":newsTitle};
        datapost=JSON.stringify(datapost);
        $.ajax({
            url : path+'/CTKJBUSINESS/sysuser/addsysuser.do',
            cache:false,//false就不会从浏览器缓存中加载请求信息了
            type:"POST",
            contentType: "application/json",
            dataType:"JSON",
            async:true,
            data: datapost,
            error: function(data){
                layer.msg("服务器未响应,请稍后再试!");
//                   console.log("新增内容运营失败：");
//                   console.log(data);
            },
            success:function(diskJson){
                layer.closeAll();
//                    console.log("新增内容运营：");
//                    console.log(diskJson);
                if(diskJson.code =="1000"){
                    layer.msg("创建成功！！")
                    replay();
                }else{
                    layer.msg("创建失败，请重试！！")
                }


            }
        });
    }



    /*重置*/
    function replay(){
        $("input.repead").val("")
    }
</script>

    
    
