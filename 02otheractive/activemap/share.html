<!doctype html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <meta content="email=no" name="format-detection">
    <title>过年了，你离家乡有多远？</title>
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
            -webkit-appearance: none;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
            -webkit-touch-callout: none;
            /* box-sizing: border-box; */
        }

        html,
        body {
            margin: 0 auto;
            width: 100%;
            min-height: 100%;
            overflow-x: hidden;
            -webkit-user-select: none;
        }

        body {
            font-family: Helvetica Neue, Helvetica, Arial, sans-serif;
            -webkit-text-size-adjust: 100%;
            -webkit-overflow-scrolling: touch;
            overflow-scrolling: touch;
            padding-top: constant(safe-area-inset-top);
            padding-left: constant(safe-area-inset-left);
            padding-right: constant(safe-area-inset-right);
            padding-bottom: constant(safe-area-inset-bottom);
            background-image: url(https://ctkj-1256675270.cos.ap-shanghai.myqcloud.com/activeallimgs/activemap/final_bg.png);
        }

        .page {
            width: 100%;
            height: 100%;
        }

        .share {
            width: 100%;
            height: 10.58rem;
            background-image: url(https://ctkj-1256675270.cos.ap-shanghai.myqcloud.com/activeallimgs/activemap/paper.png);
            position: fixed;
            top: 0.2rem;
            left: 0;
            background-position: center 0;
            background-repeat: no-repeat;
            background-size: 100% auto;
        }

        .title {
            position: absolute;
            top: 1.16rem;
            left: 1.06rem;
            font-size: 0.6rem;
            color: #902C28;
            font-weight: 700;
        }

        .rank {
            font-size: 0.29rem;
            color: #902C28;
            font-weight: 700;
            position: absolute;
            left: 1.06rem;
        }

        .two {
            top: 1.96rem;
        }

        .num {
            font-size: 0.5rem;
        }

        .three {
            top: 2.66rem;
        }

        .four {
            top: 3.08rem;
        }

        .map {
            width: 5.3rem;
            height: 2.66rem;
            background-image: url(images/red_bg.png);
            position: absolute;
            left: 1.12rem;
            top: 3.96rem;
            background-position: center 0;
            background-repeat: no-repeat;
            background-size: 100% auto;
        }

        .city {
            position: absolute;
            top: 7.46rem;
            font-size: 0.36rem;
            font-weight: 700;
            color: #000;
        }

        .left {
            left: 1.32rem;
        }

        .right {
            left: 4.84rem;
        }

        .arrow {
            width: 1.08rem;
            height: 0.18rem;
            position: absolute;
            left: 3.22rem;
            top: 7.62rem;
            background-image: url(https://ctkj-1256675270.cos.ap-shanghai.myqcloud.com/activeallimgs/activemap/goto.png);
            background-position: center 0;
            background-repeat: no-repeat;
            background-size: 100% auto;
        }

        .distance {
            position: absolute;
            top: 7.24rem;
            left: 50%;
            transform: translate(-50%, 0);
            font-size: 0.32rem;
            color: #4A5155;
            font-weight: 700;
        }

        .footer {
            position: absolute;
            left: 1.12rem;
            top: 9.12rem;
            font-size: 0.2rem;
            color: #902C28;
        }

        .code {
            width: 1.22rem;
            height: 1.22rem;
            position: absolute;
            left: 5.04rem;
            top: 8.24rem;
        }

        .logo {
            width: 0.38rem;
            height: 0.38rem;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background-image: url(https://ctkj-1256675270.cos.ap-shanghai.myqcloud.com/activeallimgs/activemap/erweima_logo.png);
            background-position: center 0;
            background-repeat: no-repeat;
            background-size: 100% auto;
        }

        .btn {
            height: 1.46rem;
            width: 3.52rem;
            position: fixed;
            top: 11.3rem;
            background-position: center 0;
            background-repeat: no-repeat;
            background-size: 100% auto;
        }

        .wydl {
            left: 0;
            background-image: url(https://ctkj-1256675270.cos.ap-shanghai.myqcloud.com/activeallimgs/activemap/wydl_button.png);
        }

        .hhdy {
            right: 0;
            background-image: url(https://ctkj-1256675270.cos.ap-shanghai.myqcloud.com/activeallimgs/activemap/hhdy_button.png);
        }

        .mask {
            width: 100%;
            height: 100%;
            position: fixed;
            top: 0;
            left: 0;
            background-color: rgb(0, 0, 0, .5);
            z-index: 999;
            display: none;
        }

        .mask_bg {
            width: 3.74rem;
            height: 2.96rem;
            position: absolute;
            top: 0.32rem;
            right: 0.4rem;
            background-image: url(https://ctkj-1256675270.cos.ap-shanghai.myqcloud.com/activeallimgs/activemap/share_guide.png);
            background-position: center 0;
            background-repeat: no-repeat;
            background-size: 100% auto;
        }
    </style>
    <script src="js/rem.js"></script>
</head>

<body>
    <div class="page">
        <div class="share">
            <p class="title">内含段友</p>
            <p class="rank two">你是第 <span class="num" id="num">18888</span> 位</p>
            <p class="rank three">踏上回家旅途的段友</p>
            <p class="rank four">你的旅途长度超过了全国<span class="num" id="per">25%</span>的段友</p>
            <div class="map" id="map">
                <canvas id="canvas"></canvas>
            </div>
            <span class="city left" id="city_lf">浙江杭州</span>
            <span class="city right" id="city_rg">北京东城</span>
            <span class="arrow"></span>
            <p class="distance"><span id="dist">1888</span>公里</p>
            <p class="footer">搜索“内含段友APP”送你一张回家车票</p>
            <div class="code">
                <div class="logo"></div>
            </div>
        </div>
        <div class="wydl btn"></div>
        <div class="hhdy btn" id="hhdy"></div>
        <div class="mask">
            <div class="mask_bg"></div>
        </div>
    </div>
    <script>
        //获取公里数
        var distance = localStorage.getItem('distance');
        distance = Math.round(distance / 1000);
        // console.log(distance)
        var dist = document.getElementById('dist');
        dist.innerText = distance;

        //获取城市
        var city_lf = document.getElementById('city_lf');
        var city_rg = document.getElementById('city_rg');
        var lf = localStorage.getItem('setout');
        var rg = localStorage.getItem('bourn');
        city_lf.innerText = lf.split(',')[0].substr(0, 2) + lf.split(',')[1].substr(0, 2);
        city_rg.innerText = rg.split(',')[0].substr(0, 2) + rg.split(',')[1].substr(0, 2);

        //公里百分比计算
        var per = document.getElementById('per');
        if (distance >= 0 && distance < 100) {
            per.innerText = '1%';
        } else if (distance >= 100 && distance < 500) {
            per.innerText = ((distance - 100) / 400 * 50).toFixed(2) + '%';
        } else if (distance >= 500 && distance < 1000) {
            per.innerText = ((distance - 500) / 500 * 20 + 50).toFixed(2) + '%';
        } else if (distance >= 1000 && distance < 2000) {
            per.innerText = ((distance - 1000) / 1000 * 10 + 70).toFixed(2) + '%';
        } else if (distance >= 2000 && distance < 3000) {
            per.innerText = ((distance - 2000) / 1000 * 10 + 80).toFixed(2) + '%';
        } else if (distance >= 3000 && distance < 4000) {
            per.innerText = ((distance - 3000) / 1000 * 10 + 90).toFixed(2) + '%';
        } else {
            per.innerText = '99%';
        }

        //排名统计
        var ajax = new XMLHttpRequest();
        ajax.open('post', 'http://192.168.1.114:8860/NHDZSEVER/activepage/countactive.do');
        ajax.setRequestHeader("Content-type", "application/json");
        let datapost={
            needcount: 'YES',
            pagestr: 'ALLINTLR'
        };
        datapost=JSON.stringify(datapost);
        ajax.send(datapost);
        ajax.onreadystatechange = function () {
            if (ajax.readyState == 4 && ajax.status == 200) {
                console.log(ajax.responseText);
                var r = 18888;
                var num = document.getElementById('num');
                r = r + 1;
                num.innerText = r;
            }
        }

        //复制路径
        var map = document.querySelector('.map');
        var width = map.offsetWidth;
        var height = map.offsetHeight;
        console.log(width, height)
        var canvas = document.querySelector('#canvas');
        var ctx = canvas.getContext('2d');
        canvas.setAttribute('width', width + 'px');
        canvas.setAttribute('height', height + 'px');

        //呼唤段友按钮
        var btn2 = document.getElementById('hhdy');
        var mask = document.querySelector('.mask');
        btn2.onclick = function () {
            mask.setAttribute('style', 'display:block');
        }
        mask.onclick = function () {
            mask.setAttribute('style', 'display:none');
        }
    </script>
    <script src="js/wxShare.js"></script>
</body>

</html>