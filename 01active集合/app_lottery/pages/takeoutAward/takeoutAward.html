

<style>
	.lottery {
		position: relative;
		display: inline-block;
		text-align:center
	}

	.lottery img {
		position: absolute;
		top: 50%;
		left: 50%;
		margin-left: -76px;
		margin-top: -82px;
		cursor: pointer;
	}

	#message {
		position: absolute;
		top: 0px;
		left: 10%;
	}
	.lottery{
		transform-origin: 0 0 0;
		-webkit-transform-origin: 0 0 0;
		-moz-transform-origin: 0 0 0;
		-o-transform-origin: 0 0 0;
		-webkit-transform: scale(0.55,0.55);
		-moz-transform: scale(0.55,0.55);
		-o-transform: scale(0.55,0.55);
		transform: scale(0.55,0.55);
	}

	.getWinBox{width:100%;height:100%;background:rgba(0,0,0,0.7);position: fixed;top:0;left:0;z-index:60;padding-top:130px;display: none;overflow: hidden;}
	.getWinBox.active{display: block;}
	.getWinConBox{width:68%;height:350px;background:#FFDF00;margin:0 auto;text-align: center;padding:22px;position: relative;z-index:1;
		-webkit-border-radius: 6px;
		-moz-border-radius: 6px;
		border-radius: 6px;}
	.getWinConBox .showimg{width:146px;height:auto;}
	.getWinBox .geiWinNumBox{width:80%;margin:0 auto;height:50px;text-align: center;font-size:1.5rem;color:#333;font-weight:600;}
	.getWinBox .getWinTitle{font-size:1.1rem;color:#333;margin:10px 0;}
	.getWinBox .geiWinNumBox img{height:100%;width:auto;vertical-align: middle;}
	.getWinBox .getwinFootBox{width:100%;height:72px;background:#fff;text-align: center;line-height: 72px;position: absolute;bottom:0;left:0;cursor: pointer;}
	.getWinBox .getwinFootBox img{width:212px;height:auto;vertical-align: middle;}
	.getWinConBox .getwinbg{width:100%;height:auto;position: absolute;left:0;top:0;z-index:5;}
	.getWinConBox .getwinJpBox{width:94%;margin:0 auto;position: relative;z-index:9;}
	.getWinConBox .winJpBox{width:70%;height:120px;text-align: center;margin:10px auto;}
	.getWinConBox .winJpBox .jpBox{display: inline-block;height:100%;}
	.getWinConBox .winJpBox .jpBox img{height:100%;width:auto;}
	.getWinConBox .winJpBox #jpName{color:#333;font-size:1rem;font-weight:600;}
	.getwinJpBox .tips{color:#414141;font-size:0.9rem;margin-top:34px;font-weight:600;}


	@media (max-width: 320px){
		.lottery{
			-webkit-transform: scale(0.5,0.5);
			-moz-transform: scale(0.5,0.5);
			-o-transform: scale(0.5,0.5);
			transform: scale(0.5,0.5);
		}
	}
	@media (min-width: 768px){
		.lottery{
			-webkit-transform: scale(0.7,0.7);
			-moz-transform: scale(0.7,0.7);
			-o-transform: scale(0.7,0.7);
			transform: scale(0.7,0.7);
		}
	}
</style>
<!--[if lte IE 8]>
	<style>
		.lottery img{
			display: none;
		}

	</style>
<![endif]-->



<div class="lottery">
	<canvas id="myCanvas" width="600" height="600" >
		当前浏览器版本过低，请使用其他浏览器尝试
	</canvas>
	<!--<p id="message"></p>-->
	<img src="https://ctkj-1256675270.cos.ap-shanghai.myqcloud.com/app_lottery/checkin/start.png" id="start">
</div>
<!--恭喜中奖-->
<!--积分-->
<div class="getWinBox " id="getJfWin">
	<div class="getWinConBox">
		<img class="showimg" src="https://ctkj-1256675270.cos.ap-shanghai.myqcloud.com/app_lottery/luckydrew/getweinimg.png" alt=""/>
		<h3 class="getWinTitle">哎呦，运气不错哦！</h3>
		<div class="geiWinNumBox">
			<img src="https://ctkj-1256675270.cos.ap-shanghai.myqcloud.com/app_lottery/luckydrew/winradish.png" alt=""/>
			x<span id="getWinNum">10</span>
		</div>
		<div class="getwinFootBox">
			<img src="https://ctkj-1256675270.cos.ap-shanghai.myqcloud.com/app_lottery/luckydrew/getwinbtn.png" alt=""/>
		</div>
	</div>
</div>
<!--实物-->
<div class="getWinBox" id="getJpWin">
	<div class="getWinConBox">
		<img class="getwinbg" src="https://ctkj-1256675270.cos.ap-shanghai.myqcloud.com/app_lottery/luckydrew/getwinjpbg.png" alt=""/>
		<div class="getwinJpBox">
			<h3 class="getWinTitle">哎呦，运气不错哦！</h3>
			<div class="winJpBox">
                   <span class="jpBox">
                       <img src="https://ctkj-1256675270.cos.ap-shanghai.myqcloud.com/app_lottery/luckydrew/getweinimg.png" alt=""/>
                   </span>
				<p id="jpName">VIVO手机</p>
			</div>
			<p class="tips">我们会在5个工作日联系您</p>
		</div>
		<div class="getwinFootBox">
			<img src="https://ctkj-1256675270.cos.ap-shanghai.myqcloud.com/app_lottery/luckydrew/getwinbtn.png" alt=""/>
		</div>
	</div>
</div>
<script>
	var wheelSurf;
	// 初始化装盘数据 正常情况下应该由后台返回
	var initData = {
		"success": true,
		"list": [{
				"id": 100,
				"name": "5000元京东卡",
				"image": "../../img/1.png",
				"rank":1,
				"percent":3
			},
			{
				"id": 101,
				"name": "1000元京东卡",
				"image": "../../img/2.png",
				"rank":2,
				"percent":5
			},
			{
				"id": 102,
				"name": "100个比特币",
				"image": "../../img/3.png",
				"rank":3,
				"percent":2
			},
			{
				"id": 103,
				"name": "50元话费",
				"image": "../../img/4.png",
				"rank":4,
				"percent":49
			},
			{
				"id": 104,
				"name": "100元话费",
				"image": "../../img/5.png",
				"rank":5,
				"percent":30
			},
			{
				"id": 105,
				"name": "500个比特币",
				"image": "../../img/6.png",
				"rank":6,
				"percent":1
			},
			{
				"id": 106,
				"name": "500元京东卡",
				"image": "../../img/7.png",
				"rank":7,
				"percent":10
			}
		]
	};

	// 计算分配获奖概率(前提所有奖品概率相加100%)
	function getGift(){
		var percent = Math.random()*100;
		var totalPercent = 0;
		for(var i = 0 ,l = initData.list.length;i<l;i++){
			totalPercent += initData.list[i].percent
			if(percent<=totalPercent){
				return initData.list[i]
			}
		}           
	}

	var list = {}
	
	var angel = 360 / initData.list.length;
	// 格式化成插件需要的奖品列表格式
	for (var i = 0, l = initData.list.length; i < l; i++) {
		list[initData.list[i].rank] = {
			id:initData.list[i].id,
			name: initData.list[i].name,
			image: initData.list[i].image
		}
	}
	// 查看奖品列表格式
	
	// 定义转盘奖品
	wheelSurf = $('#myCanvas').WheelSurf({
		list: list, // 奖品 列表，(必填)
		outerCircle: {
			color: '#df1e15' // 外圈颜色(可选)
		},
		innerCircle: {
			color: '#f4ad26' // 里圈颜色(可选)
		},
		dots: ['#fbf0a9', '#fbb936'], // 装饰点颜色(可选)
		disk: ['#ffb933', '#ffe8b5', '#ffb933', '#ffd57c', '#ffb933', '#ffe8b5', '#ffd57c'], //中心奖盘的颜色，默认7彩(可选)
		title: {
			color: '#5c1e08',
			font: '19px Arial'
		} // 奖品标题样式(可选)
	})

	// 初始化转盘
	wheelSurf.init()
	// 抽奖
	var throttle = true;
	$("#start").on('click', function () {
		//var winData = getGift(); //(随机的) 正常情况下获奖信息应该由后台返回
		var winData =initData.list[0]; //（设定的） 正常情况下获奖信息应该由后台返回

		/*$("#message").html('');*/
		if(!throttle){
			return false;
		}
		throttle = false;
		var count = 0;
		// 计算奖品角度
		for (const key in list) {
			if (list.hasOwnProperty(key)) {                    
				if (winData.id == list[key].id) {
					break;
				}
				count++    
			}
		}
  
		// 转盘抽奖，
		wheelSurf.lottery((count * angel + angel / 2), function () {
			/*$("#message").html(winData.name)*/
			throttle = true;
		})
	})

	
</script>

